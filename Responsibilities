using System.Linq;
using Microsoft.EntityFrameworkCore;

public class YourRepository
{
    private readonly YourDbContext _context;

    public YourRepository(YourDbContext context)
    {
        _context = context;
    }

    public YourOutputModel GetOutputModel(int activityTypeId)
    {
        var result = _context.LoanNoticeActivityTypes
            .Where(l => l.ActivityTypeId == activityTypeId)
            .Include(l => l.LoanNoticeActivityTags)
                .ThenInclude(lt => lt.Tag)
            .Select(l => new YourOutputModel
            {
                ActivityTypeId = l.ActivityTypeId,
                ActivityTypeName = l.ActivityTypeName,
                Tags = l.LoanNoticeActivityTags.Select(lt => new TagModel
                {
                    TagId = lt.Tag.TagId,
                    TagName = lt.Tag.TagName,
                    IsActive = lt.IsActive,
                    IsRequired = lt.IsRequired
                }).ToList()
            })
            .FirstOrDefault();

        return result;
    }
}
